# 7. 식별자, 관계, 속성의 정의



## 개요

* ### 식별자, 관계, 속성의 정의 단계는

  * #### 엔티티 기술서 및 수집문서들을 보고 엔티티의

    * ##### 주식별자

    * ##### 관계

    * ##### 관계에 따른 업무규칙

    * ##### 세부 속성

  #### 을 정의하는 단계



****

****



## 주식별자의 정의

* ### 주식별자의 정의 사례

  * 주식별자 : 에티티에 소속된 인스턴스들을 구분하는 기준이 되는 속성

    ```
    만일 어떤 속성 X가 엔티티의 주식별자라면 그 엔티티에 속한 모든 인스턴스들의 속성 X값을 비교했을 때 중복된 값이 나타나지 않아야 한다.
    ```

    ![주식별자정의사례](C:\Users\HP450G2\TIL\혁신성장 청년인재 집중양성 7기 sap 클라우드\img\주식별자정의사례.png)

****

* ### 주식별자 선정하는 법

  * 테이블을 그려본 후 중복 여부를 판단한다.
  * 주식별자(Primary Key)가 되려면 현재 시점에서 뿐만 아니라 미래의 어떤 시점에서도 중복이 있어서는 안된다.

****

* ### 주식별자의 여러 형태

  * #### 복합 속성으로 이루어진 주식별자

    ![복합속성](C:\Users\HP450G2\TIL\혁신성장 청년인재 집중양성 7기 sap 클라우드\img\복합속성.png)

    이 경우 판매일자, 제품번호, 판매수량 모두 단일 속성 만으로 주식별자가 될 수 없다. 따라서 ***판매일자/제품번호 가 묶인 복합 속성이 주식별자***가 된다.

    

  * #### 마땅한 주식별자가 없는경우

    ![마땅한주식별자가없는경우](C:\Users\HP450G2\TIL\혁신성장 청년인재 집중양성 7기 sap 클라우드\img\마땅한주식별자가없는경우.png)

    제품번호,  제조업체, 원산지 모두 중복이 되어 단일 속성으로 주식별자가 될 수 없다. 또한 두개씩 묶어 보아도 중복 되는 상황이 나오고 있다. 따라서 ***전체를 묶은 복합 속성을 주식별자***로 선택한다.

    또는 ***인위적으로 새로운 attribute를 생성하여 이를 주식별자***로 선택 할 수 있다.

    ![인위적인주식별자](C:\Users\HP450G2\TIL\혁신성장 청년인재 집중양성 7기 sap 클라우드\img\인위적인주식별자.png)

    

  * #### 인위적인 주식별자의 문제

    * 인위적 주식별자는 편리하지만 위험성도 있다.

    ![인위적인주식별자1](C:\Users\HP450G2\TIL\혁신성장 청년인재 집중양성 7기 sap 클라우드\img\인위적인주식별자1.png)

    이 경우 주식별자의 하나당 너무 많은 속성이 포함되어 인위적으로 대출 번호를 만들어 단순화 시킨 것이다. 이러한 경우 모든 엔티티가 단일 주식별자를 가지게 할 수 있다. 하지만 중복된 데이터가 입력된 경우 복합 속성을 주식별자로 선택한 경우 중복 저장 되지 않지만 인위적으로 주식별자를 생성한 경우 중복 저장된다.

    따라서 이런 경우 ***데이터의 중복을 관리할 수 있는 대안***을 미리 마련하여야 한다. 

  * #### 불필요한 속성이 주식별자에 포함되는 경우의 문제점

    * 주식별자는 ***최소한의 속성***으로 구성되어야 한다.

    ![불필요한속성](C:\Users\HP450G2\TIL\혁신성장 청년인재 집중양성 7기 sap 클라우드\img\불필요한속성.png)

    불필요한 의미적 중복이 발생할 수 있다.



****

****



## 관계/외래식별자의 정의 

* ### 관계의 정의 방법 (관계가 있는 엔티티 찾기)

  * #### 문서로 부터 동사를 구분한다.

    * EX )

      **고객**에게 **주문서**를 **<u>발송</u>**한다.

      => **고객 --(발송)-- 주문서**

  

  * #### 관계 메트릭스를 그려본다.

    ![관계메트릭스](C:\Users\HP450G2\TIL\혁신성장 청년인재 집중양성 7기 sap 클라우드\img\관계메트릭스.png)

  

  * #### 부모, 자식관계에 있는 엔티티들을 찾아본다.

    어떤 엔티티 A의 정보가 만들어지기 위해서는 다른 엔티티 B의 정보를 필요로 하는 관계에 있을때

    * 엔티티 B는 엔티티 A와 관계를 가지며
    * 엔티티 B는 엔티티 A의 부모 엔티티가 된다.

    ![부모자식엔티티](C:\Users\HP450G2\TIL\혁신성장 청년인재 집중양성 7기 sap 클라우드\img\부모자식엔티티.png)

  * #### 관계에 대해 카디낼러티와 참여도를 표시한다.

    * 카디낼러티 - (부모 엔티티 : 자식엔티티) = 1 : N

****

* ### 도서관 관리에서 관계의 도출

  ![도서관관리관계](C:\Users\HP450G2\TIL\혁신성장 청년인재 집중양성 7기 sap 클라우드\img\도서관관리관계.png)

****

* ### 외래식별자의 정의

  * 관계 있는 두 엔티티를 부모, 자식으로 구분한다.
  * 부모 엔티티의 주식별자 속성을 자식이 가지고 있는지를 확인한다.***(없는 경우 추가)***
  * ***부모 엔티티의 주식별자 속성이 자식 엔티티의 외래 식별자***로서 존재해야 한다.

  ![도서관외래](C:\Users\HP450G2\TIL\혁신성장 청년인재 집중양성 7기 sap 클라우드\img\도서관외래.png)

  ![도서관외래1](C:\Users\HP450G2\TIL\혁신성장 청년인재 집중양성 7기 sap 클라우드\img\도서관외래1.png)

  ![도서관외래2](C:\Users\HP450G2\TIL\혁신성장 청년인재 집중양성 7기 sap 클라우드\img\도서관외래2.png)

  ****

* ### 관계/외래 식별자에 대한 규칙

  * #### RULE 1

    : 두 엔티티가 관련이 있다는 의미는 두 엔티티가 공유하는 속성이 있다는 뜻이다.

  * #### RULE 2

    : 공통속성의 값이 먼저 생성되는 쪽이 부모 엔티티, 가져다 쓰는 쪽이 자식 엔티티가 된다.

  * #### RULE 3

    : 부모 엔티티에 있는 공통 속성은 주식별자이고, 자식엔티티의 공통 속성은 외래 식별자가 된다.

  * #### RULE 4

    : 부모 엔티티와 자식 엔티티의 카디낼러티는 1 : N 이다.

    * 어떤 두 엔티티가 관계가 있고 카디낼러티가 1 : N 이라면 카디낼러티가 1인쪽이 부모 엔티티이며 N인 쪽이 자식 엔티티이다.

  

****

****



## 업무 규칙의 정의

* ### 업무규칙이란

  * 관계가 있는 두 엔티티(테이블)에서 어느 한쪽의 데이터의 변화가 생기면 두 엔티티 사이에 데이터의 불일치가 발생 할 수 있다.
  * 데이터의 **불일치가 일어나지 않도록 조치**를 취해야 하는데 어떻게 조치를 취할 것인지를 정의한 것이 **업무규칙**이다.

  

  ![삭제규칙](C:\Users\HP450G2\TIL\혁신성장 청년인재 집중양성 7기 sap 클라우드\img\삭제규칙.png)

<table>
  <thead>
    <tr>
      <th>규칙</th>
      <th>형태</th>
      <th>내용</th>
    </tr>
  </thead>
  <tbody>
    <tr>
        <td rowspan=5>삭제 규칙(delete)</td>
        <td>restrict</td>
        <td>부모 테이블에 있는 값을 자식 테이블에서 참조하고 있다면 부모 테이블에 있는 그 값은 삭제할 수 없다.</td>
    </tr>
    <tr>
        <td>cascade</td>
        <td>부모 테이블에 있는 값을 삭제하면 그것을 참조하고 있는 자식 테이블의 값도 함께 삭제한다.</td>
    </tr>
    <tr>
        <td>set unll</td>
        <td>부모 테이블에 있는 값을 삭제하면 그것을 참조 하고 있는 자식 테이블의 값은 null 로 바꾼다.</td>
    </tr>
    <tr>
        <td>set default</td>
        <td>부모 테이블에 있는 값을 삭제하면 그것을 참조 하고 있는 자식 테이블의 값은 미리 지정해 놓은 다른 값으로 바뀐다.</td>
    </tr>
    <tr>
        <td>none</td>
        <td>부모 테이블에 있는 값을 삭제해도 그것을 참조하고 있는 자식 테이블의 값을 그대로 유지한다.</td>
    </tr>
    <tr>
        <td rowspan=5>수정 규칙(update)</td>
        <td>restrict</td>
        <td>부모 테이블에 있는 값을 자식 테이블에서 참조하고 있다면 부모 테이블에 있는 그 값은 수정할 수 없다.</td>
    </tr>
    <tr>
        <td>cascade</td>
        <td>부모 테이블에 있는 값을 수정하면 그것을 참조하고 있는 자식 테이블의 값도 함께 수정한다.</td>
    </tr>
    <tr>
        <td>set unll</td>
        <td>부모 테이블에 있는 값을 수정하면 그것을 참조 하고 있는 자식 테이블의 값은 null 로 바꾼다.</td>
    </tr>
    <tr>
        <td>set default</td>
        <td>부모 테이블에 있는 값을 수정하면 그것을 참조 하고 있는 자식 테이블의 값은 미리 지정해 놓은 다른 값으로 바뀐다.</td>
    </tr>
    <tr>
        <td>none</td>
        <td>부모 테이블에 있는 값을 수정해도 그것을 참조하고 있는 자식 테이블의 값을 그대로 유지한다.</td>
    </tr>
  </tbody>
</table>


<table>
  <thead>
    <tr>
      <th>규칙</th>
      <th>형태</th>
      <th>내용</th>
    </tr>
  </thead>
  <tbody>
    <tr>
        <td rowspan=2>삽입 규칙(insert)</td>
        <td>restrict</td>
        <td>자식 테이블에서 튜플을 삽입할 때 부모 테이블에 없는 값을 사용하면 튜플 삽입이 안되게 한다.</td>
    </tr>
    <tr>
        <td>none</td>
        <td>자식 테이블에서 튜플을 삽입할 때 어떤 값으르 사용해도 튜플이 삽입된다.</td>
    </tr>
    <tr>
        <td rowspan=2>수정 규칙(update)</td>
        <td>restrict</td>
        <td>자식 테이블에서 튜플을 수정할 때 부모 테이블에 없는 값을 사용하면 튜플 수정이 안되게 한다.</td>
    </tr>
    <tr>
        <td>none</td>
        <td>자식 테이블에서 튜플을 변경할 때 어떤 값으르 사용해도 튜플이 변경된다.</td>
    </tr>
  </tbody>
</table>

****

* ### 모델링 도구에서 업무 규칙의 정의

  ![규칙정의](C:\Users\HP450G2\TIL\혁신성장 청년인재 집중양성 7기 sap 클라우드\img\규칙정의.png)



****

****




## 속성의 정의

* ### 개요

  * 속성을 찾는 작업은 모델링 전 과정에서 지속적으로 발생한다. (심지어 프로그램의 코딩 단계에서 추가되는 경우도 있다.)
  * 주요 속성은 엔티티 정의 단계에서 대부분 도출된다.
  * 하나의 속성은 ERD 전체에서 한번만 나타나는 것이 원칙이다. 그렇지 않으면 중복.
    * 관계의 연결을 위한 외래 식별자의 경우는 예외

****

* ### 속성의 종류

  * #### 기본 속성

    * 업무의 분석 과저에서 도출되는 속성들로서 현실 세계에 존재하는 정보를 반영
    * 전체 속성에서 가장 많은 비율을 차지
    * 이름, 나이, 수량, 무게, 직위, 전공, 주소, 전화번호, ....

  

  * #### 설계 속성

    * 실제 업무의 분석 내용에는 존재하지 않았지만 정보를 효과적으로 관리하기 위해 설계의 차원에서 새로 만드는 속성

    * 부서코드, 색상코드, 튜플 삭제여부, Lock, .....

      ![설계속성](C:\Users\HP450G2\TIL\혁신성장 청년인재 집중양성 7기 sap 클라우드\img\설계속성.png)

      ![설계속성1](C:\Users\HP450G2\TIL\혁신성장 청년인재 집중양성 7기 sap 클라우드\img\설계속성1.png)

    

  * #### 유도 속성

    * 다른 속성으로 부터 유도될 수 있는 속성

    * 유도 속성은 ***데이터의 불일치***를 가져올 수 있으므로 주의한다!!

      ![유도속성불일치](C:\Users\HP450G2\TIL\혁신성장 청년인재 집중양성 7기 sap 클라우드\img\유도속성불일치.png)

    * 유도 속성의 경우 필요한 경우에 데이터를 뽑아서 사용하지 테이블에 만드는 경우는 드물다!!

    * 금액 ( = 수량 * 단가)







****

****

****



### 실전 예제1

* #### A 회사의 광주 공장에는 8개의 건물이 있다. 건물정보와 각 건물별 사무실 정보를 관리하려고 한다. 요구조건이 다음과 같을 때 필요한 ERD를 작성하시오.

  * ##### 각 건물은 건물 코드, 명칭, 면적, 경비실 연락처 정보를 관리한다.

  * ##### 각 사무실은 사무실호수(room number), 명칭, 면적, 용도 전화번호 정보를 관리한다.

  * ##### 사무실용도는 코드 관리를 한다.

  * ##### 각 사무실에 대해 유지보수가 필요하므로 유지보수 시마다 이력을 관리해야 한다.

  * ##### 각 사무실은 보안관리를 위해 외부 출입자 정보를 관리해야 한다. 방문자 이름, 연락처, 들어온 시간, 나간 시간, 용건을 관리한다.







****

****



### 실전 예제2

* #### 해당 내용을 참고하여 ERD 작성.

  * 여행사의 **항공권 예약 업무**이다.

  * 예약을 원하는 **고객**은 **회원가입**을 하여야 한다.

  * **예약 요청일**의 **항공 스케줄** 과 **잔여 좌석 여부**를 확인한다. (항공사 시스템 조회)

  * 예약 성공의 경우 **예약 정보를 기록**한다.

  * **예약정보**에는 ***자체관리번호 , 예약일, 에약자, 항공사승인번호, 항공편명, 탑승일, 탑승자 정보***를 관리한다.

  * 한건의 **예약에 대해 하나의 관리번호**가 부여되며, **여러개의 항공권**을 포함할 수 있다.

* ### 항공사 시스템에서 관리해야할 정보는 ERD에 포함시키지 않는다.



entity

고객

